# MyPhotos

![image](https://github.com/45474F52/MyPhotos/assets/98253223/c9b221f9-2636-4df0-8641-cc047698db17)

My Photos представляет собой RESTful API систему, которая позволяет:
* Регистрировать пользователей
* Проходить систему авторизации
* Просматривать свои изображения, загружать новые
* Просматривать список своих друзей, заявки на добавления в друзья
* Удалять, добавлять новых друзей
* Просматривать изображения своих друзей

My Photos по умолчанию сохраняет данные в локальную БД, а изображения — в каталог на рабочем столе

При желании строку подключения и путь до хранилища изображений можно изменить в файле appsettings.json

# Account

Авторизация происходит следующим образом:
1) Пользователь вводит логин и пароль
2) Происходит поиск подходящей записи в БД
3) Создаётся список Claims, в котором хранится логин пользователя
4) Генерируется JWT токен. JWT токен остаётся валидным 30 секунд до применения и 2 минуты после применения. Шифруется при помощи симметричного ключа и алгоритма HmacSha256
5) Создаётся ответ на запрос с JWT токеном и логином
6) В HttpContext добавляется User с списком Claims (п.3)
7) При следующих запросах в контекст будет добавлен заголовок ("Authorization", "Bearer " + JWT токен из Http контекста)

При выходе пользователя сбрасывается User в HttpContext и очищается сессия

При регистрации пользователь автоматически авторизируется

# Friends

Таблица заявок на добавление в друзья в БД выглядит следующим образом:

![image](https://github.com/45474F52/MyPhotos/assets/98253223/bad156c7-21b2-4630-8363-bea6ef4fd1ca)

Где:
- StatusId: статус запроса на дружбу. Может быть "ignored" (по умолчанию) или "friend", если второй пользователь принял заявку первого
- RelatingUserId: пользователь, который отправил заявку другому пользователю
- RelatedUserId: пользователь, которому была отправлена заявка

# Photos

API предоставляет функционал выбора файла непосредственно в Swagger UI. Передаваемый формат объекта в метод контроллера — IFormFile.
Изображение сохраняется в директорию по пути из appsettings.json (при необходимости она сама создаётся).
Далее, в директории создаётся папка с логином пользователя, который добавляет изображение. В этой папке хранится само изображение.
В БД сохраняется лишь название и формат изображения. Остальная часть пути подставляется исходя из настроек appsettings.json и логина пользователя.
